<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title> - Solar Eclipse and Wildlife Movements</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/quarto-contrib/academicons-1.9.2/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/academicons-1.9.2/size.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="academicons.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title"><i class="fa-solid fa-globe" aria-label="globe"></i></span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text"><i class="fa-solid fa-house" aria-label="house"></i> Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html">
 <span class="menu-text"><i class="fa-solid fa-file" aria-label="file"></i> CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./eclipseproj.html" aria-current="page">
 <span class="menu-text"><i class="fa-solid fa-moon" aria-label="moon"></i> Eclipse Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./fsvmproj.html">
 <span class="menu-text"><i class="fa-solid fa-tree" aria-label="tree"></i> FSVM</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./seasonalranges.html">
 <span class="menu-text"><i class="fa-solid fa-paw" aria-label="paw"></i> Seasonal Ranges</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#fa-scroll-python-function" id="toc-fa-scroll-python-function" class="nav-link active" data-scroll-target="#fa-scroll-python-function"><i class="fa-solid fa-scroll" aria-label="scroll"></i> Python function</a></li>
  <li><a href="#fa-code-r-code" id="toc-fa-code-r-code" class="nav-link" data-scroll-target="#fa-code-r-code"><i class="fa-solid fa-code" aria-label="code"></i> R Code</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Solar Eclipse and Wildlife Movements</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>During my masterâ€™s thesis, I completed a side project funded by a NASA mini-grant which assessed wildlife movements during the 2017 Great American Solar Eclipse. GPS data was provided by a number of collaborators from across the country. I published one <a href="https://www.mdpi.com/2076-2615/9/2/59/htm">article</a> related to this research, and another is currently in preparation, but the analysis is on-going. I recently enhanced this analysis by leveraging the powerful astronomical calculation Python module <a href="https://pypi.org/project/ephem/"><code>ephem</code></a> into a function called by R to assess the conditions of the solar eclipse experienced by each recorded location of each individual animal in order to parse potential behavioral changes related to the eclipse. This research is currently being prepared for <em>Movement Ecology</em>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="_images/SolarEclipseMap_Final.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Map of average locations during 2017 Great American Solar Eclipse.</figcaption><p></p>
</figure>
</div>
<section id="fa-scroll-python-function" class="level2">
<h2 class="anchored" data-anchor-id="fa-scroll-python-function"><i class="fa-solid fa-scroll" aria-label="scroll"></i> Python function</h2>
<p>I created a function in Python inspired by a script I found which calculated the start time for a particular eclipse (March 2015) at one particular location. I expanded it to return the start and end times of the eclipse, the time of the maximum eclipse, and the maximum obscuration percentage (how much of the sun was blocked at the eclipse maximum).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------- Eclipse Percent Py ------------------------------------------#</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sourced from : Graeme Coates, March 18, 2015</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Accessed: 10/8/21</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.chromosphere.co.uk/wp-content/blogs.dir/1/files/2015/03/eclipse_percent.py</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.chromosphere.co.uk/2015/03/18/eclipse-calculations-using-python/</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------------#</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Modified by Rob Ritson, 10/18/2021 into a function for Great American Solar Eclipse</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Args: Longitude (dd.mmmm), Latitude (dd.mmmm), Elevation (meters)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns: MaxEclipseTime (GMT), MaxEclipsePercent (obscuration), FirstContactTime, LastContactTime</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Uses Python module ephem</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------------#</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ephem</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> n</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> operator <span class="im">import</span> itemgetter</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_non_zero(x):</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> eclipse_calculator(longitude, latitude, elevation):</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Calculate Eclipse Conditions"""</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  timetuple<span class="op">=</span>(<span class="dv">2017</span>, <span class="dv">8</span>, <span class="dv">21</span>, <span class="dv">00</span>, <span class="dv">00</span>, <span class="dv">00</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  gatech<span class="op">=</span>ephem.Observer()</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  gatech.epoch<span class="op">=</span> <span class="st">'2017'</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  gatech.date<span class="op">=</span>timetuple</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  gatech.lon<span class="op">=</span>longitude</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  gatech.lat<span class="op">=</span>latitude</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  gatech.elevation<span class="op">=</span>elevation</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  gatech.compute_pressure()</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  sun, moon <span class="op">=</span> ephem.Sun(gatech), ephem.Moon(gatech)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  results<span class="op">=</span>[]</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">86400</span>):</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>      gatech.date<span class="op">=</span> (ephem.date(ephem.date(timetuple)<span class="op">+</span>x<span class="op">*</span>ephem.second))</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>      sun.compute(gatech)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      moon.compute(gatech)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      r_sun<span class="op">=</span>(sun.size<span class="op">/</span><span class="fl">2.0</span>)<span class="op">/</span><span class="fl">3600.0</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      r_moon<span class="op">=</span>(moon.size<span class="op">/</span><span class="fl">2.0</span>)<span class="op">/</span><span class="fl">3600.0</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      s<span class="op">=</span>n.degrees(ephem.separation((sun.az, sun.alt), (moon.az, moon.alt)))</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">try</span>:</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> s<span class="op">&lt;</span>(r_moon<span class="op">+</span>r_sun):</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>              lunedelta<span class="op">=</span><span class="fl">0.25</span><span class="op">*</span>math.sqrt((r_sun<span class="op">+</span>r_moon<span class="op">+</span>s)<span class="op">*</span>(r_moon<span class="op">+</span>s<span class="op">-</span>r_sun)<span class="op">*</span>(s<span class="op">+</span>r_sun<span class="op">-</span>r_moon)<span class="op">*</span>(r_sun<span class="op">+</span>r_moon<span class="op">-</span>s))</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>          <span class="cf">else</span>: </span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>              lunedelta<span class="op">=</span><span class="va">None</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>              percent_eclipse<span class="op">=</span><span class="dv">0</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> lunedelta: </span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>              lune_area<span class="op">=</span><span class="dv">2</span><span class="op">*</span>lunedelta <span class="op">+</span> r_sun<span class="op">*</span>r_sun<span class="op">*</span>(math.acos(((r_moon<span class="op">*</span>r_moon)<span class="op">-</span>(r_sun<span class="op">*</span>r_sun)<span class="op">-</span>(s<span class="op">*</span>s))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>r_sun<span class="op">*</span>s))) <span class="op">-</span> r_moon<span class="op">*</span>r_moon<span class="op">*</span>(math.acos(((r_moon<span class="op">*</span>r_moon)<span class="op">+</span>(s<span class="op">*</span>s)<span class="op">-</span>(r_sun<span class="op">*</span>r_sun))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>r_moon<span class="op">*</span>s)))</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>              percent_eclipse<span class="op">=</span>(<span class="dv">1</span><span class="op">-</span>(lune_area<span class="op">/</span>(math.pi<span class="op">*</span>r_sun<span class="op">*</span>r_sun)))<span class="op">*</span><span class="dv">100</span> </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>          results.append([gatech.date.datetime(),s,sun.size,moon.size,lune_area <span class="cf">if</span> lunedelta <span class="cf">else</span> <span class="dv">0</span>, percent_eclipse]) </span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  gen<span class="op">=</span>(x <span class="cf">for</span> x <span class="kw">in</span> results) </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  max_eclipse<span class="op">=</span><span class="bu">max</span>(gen, key<span class="op">=</span>itemgetter(<span class="dv">5</span>))</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  MaxEclipseTime <span class="op">=</span> <span class="bu">str</span>(max_eclipse[<span class="dv">0</span>])</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  MaxEclipsePercent <span class="op">=</span> max_eclipse[<span class="dv">5</span>]</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  gen<span class="op">=</span>(x <span class="cf">for</span> x <span class="kw">in</span> results) </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    FirstContactTime <span class="op">=</span> <span class="bu">str</span>(<span class="bu">next</span>(x <span class="cf">for</span> x <span class="kw">in</span> gen <span class="cf">if</span> check_non_zero(x[<span class="dv">5</span>]))[<span class="dv">0</span>]) </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span>:</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    FirstContactTime <span class="op">=</span> <span class="bu">str</span>(<span class="st">'NA'</span>) </span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    LastContactTime <span class="op">=</span> <span class="bu">str</span>(<span class="bu">next</span>(x <span class="cf">for</span> x <span class="kw">in</span> gen <span class="cf">if</span> x[<span class="dv">5</span>]<span class="op">==</span><span class="dv">0</span>)[<span class="dv">0</span>]) </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span>: </span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    LastContactTime <span class="op">=</span> <span class="bu">str</span>(<span class="st">'NA'</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  out <span class="op">=</span> [MaxEclipseTime, MaxEclipsePercent, FirstContactTime, LastContactTime]</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the next step, I could subset the locations of individuals which actually experienced the eclipse, based on whether the timestamp of the particular location was within the start and end time of the eclipse at that location, and calculate how much of the sun was obscured at that particular instance. This will be used in further analyses in R examining behavioral change points and segementation to examine whether changes in behavior correspond with or relate to eclipse conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">-------------------------</span> Eclipse Percent Py <span class="op">------------------------------------------</span><span class="co">#</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sourced from : Graeme Coates, March 18, 2015</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Accessed: 10/8/21</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.chromosphere.co.uk/wp-content/blogs.dir/1/files/2015/03/eclipse_percent.py</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.chromosphere.co.uk/2015/03/18/eclipse-calculations-using-python/</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------------#</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Modified by Rob Ritson, 1/17/2022 into a function for Great American Solar Eclipse</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Args: hr (hour), mn (minutes), sc (seconds), Longitude (dd.mmmm), Latitude (dd.mmmm), Elevation (meters)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># First three arguments are used to create timetuple object for calculating eclipse circumstances</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns: percent eclipse</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Uses Python module ephem</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------------#</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ephem</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> n</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> eclipse_calculator_local(hr, mn, sc, longitude, latitude, elevation):</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Calculate Eclipse Conditions"""</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  timetuple<span class="op">=</span>(<span class="dv">2017</span>, <span class="dv">8</span>, <span class="dv">21</span>, hr, mn, sc)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  gatech<span class="op">=</span>ephem.Observer()</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  gatech.epoch<span class="op">=</span> <span class="st">'2017'</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  gatech.date<span class="op">=</span>timetuple</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  gatech.lon<span class="op">=</span>longitude</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  gatech.lat<span class="op">=</span>latitude</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  gatech.elevation<span class="op">=</span>elevation</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  gatech.compute_pressure()</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  sun, moon <span class="op">=</span> ephem.Sun(gatech), ephem.Moon(gatech)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  sun.compute(gatech)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  moon.compute(gatech)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  r_sun<span class="op">=</span>(sun.size<span class="op">/</span><span class="fl">2.0</span>)<span class="op">/</span><span class="fl">3600.0</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  r_moon<span class="op">=</span>(moon.size<span class="op">/</span><span class="fl">2.0</span>)<span class="op">/</span><span class="fl">3600.0</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  s<span class="op">=</span>n.degrees(ephem.separation((sun.az, sun.alt), (moon.az, moon.alt)))</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> s<span class="op">&lt;</span>(r_moon<span class="op">+</span>r_sun):</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>      lunedelta<span class="op">=</span><span class="fl">0.25</span><span class="op">*</span>math.sqrt((r_sun<span class="op">+</span>r_moon<span class="op">+</span>s)<span class="op">*</span>(r_moon<span class="op">+</span>s<span class="op">-</span>r_sun)<span class="op">*</span>(s<span class="op">+</span>r_sun<span class="op">-</span>r_moon)<span class="op">*</span>(r_sun<span class="op">+</span>r_moon<span class="op">-</span>s))</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>      lunedelta<span class="op">=</span><span class="va">None</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>      percent_eclipse<span class="op">=</span><span class="dv">0</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> lunedelta: </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>      lune_area<span class="op">=</span><span class="dv">2</span><span class="op">*</span>lunedelta <span class="op">+</span> r_sun<span class="op">*</span>r_sun<span class="op">*</span>(math.acos(((r_moon<span class="op">*</span>r_moon)<span class="op">-</span>(r_sun<span class="op">*</span>r_sun)<span class="op">-</span>(s<span class="op">*</span>s))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>r_sun<span class="op">*</span>s))) <span class="op">-</span> r_moon<span class="op">*</span>r_moon<span class="op">*</span>(math.acos(((r_moon<span class="op">*</span>r_moon)<span class="op">+</span>(s<span class="op">*</span>s)<span class="op">-</span>(r_sun<span class="op">*</span>r_sun))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>r_moon<span class="op">*</span>s)))</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>      percent_eclipse<span class="op">=</span>(<span class="dv">1</span><span class="op">-</span>(lune_area<span class="op">/</span>(math.pi<span class="op">*</span>r_sun<span class="op">*</span>r_sun)))<span class="op">*</span><span class="dv">100</span> </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> percent_eclipse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fa-code-r-code" class="level2">
<h2 class="anchored" data-anchor-id="fa-code-r-code"><i class="fa-solid fa-code" aria-label="code"></i> R Code</h2>
<p>This R script calls the the above Python script using <code>reticulate</code>, executes these in parallel using the <code>furrr</code> package, then saves the outputs for further analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate Local Circumstances of Great American Solar Eclipse ####</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">c</span>(<span class="st">"data.table"</span>,<span class="st">"reticulate"</span>,<span class="st">"furrr"</span>,<span class="st">"readr"</span>,<span class="st">"progressr"</span>,<span class="st">"future"</span>),require,<span class="at">character.only=</span>T)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Source Python Script (EclipseCalculator.py)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">source_python</span>(<span class="st">"C:/Users/r2j2r/Documents/Research Projects/eclipse/EclipseCalculator.py"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">"C:/Users/r2j2r/Documents/Research Projects/eclipse/GASE_elevation.csv"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Latitude <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>Latitude)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Longitude <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>Longitude)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate Local Circumstances of Eclipse</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#todo &lt;- df</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>todo <span class="ot">&lt;-</span> <span class="fu">subset</span>(df,<span class="sc">!</span>(df<span class="sc">$</span>ID <span class="sc">%in%</span> out_df<span class="sc">$</span>ID))</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>out_df <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(todo<span class="sc">$</span>ID))){</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  elev_df <span class="ot">&lt;-</span> <span class="fu">subset</span>(todo, todo<span class="sc">$</span>ID <span class="sc">==</span> <span class="fu">unique</span>(todo<span class="sc">$</span>ID)[i])</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  arg_list <span class="ot">&lt;-</span> elev_df[,<span class="fu">c</span>(<span class="st">"Longitude"</span>,<span class="st">"Latitude"</span>,<span class="st">"elevation"</span>)]</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(arg_list) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  future<span class="sc">::</span><span class="fu">plan</span>(multicore,<span class="at">workers =</span> <span class="fu">availableCores</span>()<span class="sc">-</span><span class="dv">1</span>) <span class="co">#parallel processing</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  skip <span class="ot">&lt;-</span> F</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    progressr<span class="sc">::</span><span class="fu">with_progress</span>({</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> progressr<span class="sc">::</span><span class="fu">progressor</span>(<span class="at">steps =</span> <span class="fu">nrow</span>(arg_list))</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>      final <span class="ot">&lt;-</span> furrr<span class="sc">::</span><span class="fu">future_pmap</span>(arg_list, <span class="cf">function</span>(long, lat, elev){ </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">p</span>() <span class="co">#add progress bar</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        e <span class="ot">&lt;-</span> <span class="fu">eclipse_calculator</span>(long, lat, elev)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  },<span class="at">error =</span> <span class="cf">function</span>(e){skip <span class="ot">&lt;&lt;-</span> T})</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(skip){<span class="cf">next</span>}</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  final_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="fu">unlist</span>(final), <span class="at">nrow =</span> <span class="fu">length</span>(final), <span class="at">byrow=</span><span class="cn">TRUE</span>))</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(final_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"MaxEclipseTime"</span>,<span class="st">"MaxObscuration"</span>,<span class="st">"FirstContact"</span>,<span class="st">"LastContact"</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">cbind</span>(elev_df,final_df)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">"MaxEclipseTime"</span>]] <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(out[[<span class="st">"MaxEclipseTime"</span>]],<span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M:%OS"</span>,<span class="at">tz=</span><span class="st">"GMT"</span>)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">"FirstContact"</span>]] <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(out[[<span class="st">"FirstContact"</span>]],<span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M:%OS"</span>,<span class="at">tz=</span><span class="st">"GMT"</span>)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">"LastContact"</span>]] <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(out[[<span class="st">"LastContact"</span>]],<span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M:%OS"</span>,<span class="at">tz=</span><span class="st">"GMT"</span>)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  out_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(out_df, out)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Iteration"</span>,i,<span class="st">"of"</span>,<span class="fu">length</span>(<span class="fu">unique</span>(todo<span class="sc">$</span>ID)),<span class="st">"Completed"</span>))</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(out_df,<span class="st">"C:/Users/r2j2r/Documents/Research Projects/eclipse/GASELocalConditions.csv"</span>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>nas <span class="ot">&lt;-</span> <span class="fu">subset</span>(out_df,<span class="fu">is.na</span>(out_df<span class="sc">$</span>FirstContact)) <span class="co">#Indiv 154 is only NAs (brown pelican)</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>out_df<span class="ot">&lt;-</span> <span class="fu">subset</span>(out_df,<span class="sc">!</span><span class="fu">is.na</span>(out_df<span class="sc">$</span>FirstContact))</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(out_df<span class="sc">$</span>FirstContact))</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(out_df,<span class="st">"C:/Users/r2j2r/Documents/Research Projects/eclipse/GASELocalConditions.csv"</span>) <span class="co">#Clean file</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="do">#####</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate Eclipse Duration and Identify Eclipse Locations ####</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(lubridate)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>eclipse <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">"C:/Users/r2j2r/Documents/Research Projects/eclipse/GASELocalConditions.csv"</span>)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>eclipse<span class="sc">$</span>interval <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">interval</span>(eclipse<span class="sc">$</span>FirstContact, eclipse<span class="sc">$</span>LastContact)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>eclipse<span class="sc">$</span>duration_sec <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(lubridate<span class="sc">::</span><span class="fu">as.duration</span>(eclipse<span class="sc">$</span>interval))</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>eclipse<span class="sc">$</span>active_eclipse <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(eclipse<span class="sc">$</span>Timestamp <span class="sc">%within%</span> eclipse<span class="sc">$</span>interval,<span class="st">'Yes'</span>,<span class="st">'No'</span>)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(eclipse,<span class="st">"C:/Users/r2j2r/Documents/Research Projects/eclipse/GASELocalConditions.csv"</span>)</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="do">####</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="do">## Load packages</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">c</span>(<span class="st">"data.table"</span>,<span class="st">"reticulate"</span>,<span class="st">"furrr"</span>,<span class="st">"readr"</span>,<span class="st">"progressr"</span>,<span class="st">"future"</span>),require,<span class="at">character.only=</span>T)</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="do">## Load Data</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>eclipse <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">"C:/Users/r2j2r/Documents/Research Projects/eclipse/GASELocalConditions.csv"</span>)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset Eclipse Locations</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>active <span class="ot">&lt;-</span> <span class="fu">subset</span>(eclipse,eclipse<span class="sc">$</span>active_eclipse<span class="sc">==</span><span class="st">'Yes'</span>)</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>active<span class="sc">$</span>hour <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(active<span class="sc">$</span>Timestamp)</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>active<span class="sc">$</span>minute <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">minute</span>(active<span class="sc">$</span>Timestamp)</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>active<span class="sc">$</span>second <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">second</span>(active<span class="sc">$</span>Timestamp)</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percent eclipse for each location recorded during the eclipse #</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">source_python</span>(<span class="st">"C:/Users/r2j2r/Documents/Research Projects/eclipse/EclipseCalculatorLocalConditions.py"</span>)</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate Local Circumstances of Eclipse Conditions</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>arg_list <span class="ot">&lt;-</span> active[,<span class="fu">c</span>(<span class="st">"hour"</span>,<span class="st">"minute"</span>,<span class="st">"second"</span>,<span class="st">"Longitude"</span>,<span class="st">"Latitude"</span>,<span class="st">"elevation"</span>)]</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(arg_list) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(multicore,<span class="at">workers =</span> <span class="fu">availableCores</span>()<span class="sc">-</span><span class="dv">1</span>) <span class="co">#parallel processing</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>progressr<span class="sc">::</span><span class="fu">with_progress</span>({</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> progressr<span class="sc">::</span><span class="fu">progressor</span>(<span class="at">steps =</span> <span class="fu">nrow</span>(arg_list))</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>  final <span class="ot">&lt;-</span> furrr<span class="sc">::</span><span class="fu">future_pmap</span>(arg_list, <span class="cf">function</span>(hr, mn, sc, long, lat, elev){ </span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">p</span>() <span class="co">#add progress bar</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>        e <span class="ot">&lt;-</span> <span class="fu">eclipse_calculator_local</span>(hr, mn, sc, long, lat, elev)</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>final_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="fu">unlist</span>(final), <span class="at">nrow =</span> <span class="fu">length</span>(final), <span class="at">byrow=</span><span class="cn">TRUE</span>))</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(final_df) <span class="ot">&lt;-</span> <span class="st">"Observed_Obscuration"</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">cbind</span>(active,final_df)</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(out,<span class="st">"C:/Users/r2j2r/Documents/Research Projects/eclipse/GASELocalConditions_Active.csv"</span>)</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="do">#####</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Â© 2023 Robert Ritson</div>   
      <div class="nav-footer-center">powered by <a href="https://quarto.org">quarto</a></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/r2j2ritson/RSpatial_Wildlife">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://www.researchgate.net/profile/Robert-Ritson"><i class="ai  ai-researchgate" title="" style="color:"></i></a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=NfH3WwcAAAAJ&amp;hl=en"><i class="ai  ai-google-scholar" title="" style="color:"></i></a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>